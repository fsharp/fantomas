<Project>

    <Target
        Name="AnalyzeProject" 
        DependsOnTargets="Restore;ResolveAssemblyReferencesDesignTime;ResolveProjectReferencesDesignTime;ResolvePackageDependenciesDesignTime;FindReferenceAssembliesForReferences;_GenerateCompileDependencyCache;_ComputeNonExistentFileProperty;BeforeBuild;BeforeCompile;CoreCompile">
        
        <Message Importance="low" Text="fsc arguments: @(FscCommandLineArgs)" />
        <Message Importance="High" Text="Analyzing $(MSBuildProjectFile)"/>
        <PropertyGroup>
            <DOTNET_ROLL_FORWARD_TO_PRERELEASE>1</DOTNET_ROLL_FORWARD_TO_PRERELEASE>
            <DOTNET_ROLL_FORWARD>LatestMajor</DOTNET_ROLL_FORWARD>
            <AnalyzerFlags>--fsc-args &quot;@(FscCommandLineArgs)&quot;</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --analyzers-path &quot;$(PkgG-Research_FSharp_Analyzers)/analyzers/dotnet/fs&quot;</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --analyzers-path &quot;$(PkgIonide_Analyzers)/analyzers/dotnet/fs&quot;</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --exclude-analyzer PartialAppAnalyzer</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --treat-as-warning GRA-STRING-001 GRA-STRING-002 GRA-STRING-003 GRA-UNIONCASE-001 IONIDE-001 IONIDE-002 IONIDE-003 IONIDE-004 IONIDE-005</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --verbose</AnalyzerFlags>
            <AnalyzerFlags>$(AnalyzerFlags) --report &quot;$(CodeRoot)/analysisreports/$(MSBuildProjectName)-analysis.sarif&quot;</AnalyzerFlags>
        </PropertyGroup>
        <Exec
            ContinueOnError="true"
            Command="dotnet fsharp-analyzers $(AnalyzerFlags)">
            <Output TaskParameter="ExitCode" PropertyName="LastExitCode" />
        </Exec>
        <Error Condition="'$(LastExitCode)' == '-2'" Text="Problems were found $(MSBuildProjectFile)" />

    </Target>

</Project>